http-server:
  addr: ":7096"
health:
  path: "/api/health"

grpc-server:
  addr: ":7080"

service-register:

elasticsearch:
  urls: "${ES_URL:http://localhost:9200}"
  security: ${ES_SECURITY_ENABLE:false}
  username: "${ES_SECURITY_USERNAME}"
  password: "${ES_SECURITY_PASSWORD}"

elasticsearch@logs:
  urls: "${LOGS_ES_URL:http://localhost:9200}"
  security: ${LOGS_ES_SECURITY_ENABLE:false}
  username: "${LOGS_ES_SECURITY_USERNAME}"
  password: "${LOGS_ES_SECURITY_PASSWORD}"

cassandra:
  host: "${CASSANDRA_ADDR:localhost:9042}"
  security: ${CASSANDRA_SECURITY_ENABLE:false}
  username: ${CASSANDRA_SECURITY_USERNAME}
  password: ${CASSANDRA_SECURITY_PASSWORD}
  timeout: "${CASSANDRA_TIMEOUT:3s}"

mysql:
  host: "${MYSQL_HOST:localhost}"
  port: ${MYSQL_PORT:3306}
  username: "${MYSQL_USERNAME:root}"
  password: "${MYSQL_PASSWORD:123456}"
  database: "${MYSQL_DATABASE:dice}"

etcd:
  endpoints: "${ETCD_ENDPOINTS:http://localhost:2379}"
  tls:
    cert_file: "/certs/etcd-client.pem"
    cert_key_file: "/certs/etcd-client-key.pem"
    ca_file: "/certs/etcd-ca.pem"

etcd-election@index:
  root_path: "/erda/monitor-index-clean-election"

redis:
  addr: "${REDIS_ADDR}"
  password: "${REDIS_PASSWORD}"
  db: ${REDIS_DB:0}
  master_name: "${REDIS_MASTER_NAME}"
  sentinels_addr: "${REDIS_SENTINELS_ADDR}"

permission:

# log
elasticsearch.index.loader@log:
  load_mode: "LoadWithCache"
  index_reload_interval: "1m"
  query_index_time_range: true
  cache_key_prefix: "es-index-log"
  match:
    - prefix: "erda-logs-"
      patterns:
        - "<org>-{number}"
        - "<org>.<key>-{number}"
storage-retention-strategy@log:
  default_ttl: "${LOG_TTL:168h}"
  load_from_database: true
  ttl_reload_interval: "3m"
elasticsearch.index.retention-strategy@log:
  key_patterns: 
    - "erda-logs-<org>.<key>-{number}"
elasticsearch.index.cleaner@log:
  check_interval: "30m"
  print_onluy: true
  disk_clean:
    enable: ${LOG_DISK_CLEAN_ENABLE:true}
    check_interval: "1m"
    high_disk_usage_percent: ${HIGH_DISK_USAGE_PERCENT:80} # 触发磁盘清理的容量占比
    low_disk_usage_percent: ${LOW_DISK_USAGE_PERCENT:70} # 触发磁盘清理时，尽量清理到的目标容量占比
    min_indices_store: "${MIN_INDICES_STORE_PERCENT:10GB}" # 磁盘使用率高时，保证 索引最少可以占用的容量
    min_indices_store_percent: ${MIN_INDICES_STORE_PERCENT:10} # 磁盘使用率高时，保证 索引最少可以占用总磁盘总量的百分比
    rollover_body_file: "${CONFIG_PATH}/index_rollover_min.json"
    rollover_alias_patterns:
      - index: "erda-logs-<org>-{number}"
        alias: "erda-logs-<org>-rollover"
      - index: "erda-logs-<org>.<key>-{number}"
        alias: "erda-logs-<org>.<key>-rollover"
log-storage-elasticsearch:
  query_timeout: "1m"
  read_page_size: 200
kubernetes-logs-storage:
  client_cache_size: 128
  client_cache_expiration: "10m"
  pod_info_cache_size: 256
  pod_info_cache_expiration: "3h"
  buffer_lines: 200
log-storage-cassandra:
  _enable: ${QUERY_LOG_IN_CASSANDRA_ENABLE:true}
  read_page_size: 201
  cassandra:
    keyspace:
      name: "spot_prod"
erda.core.monitor.log.query:

# metric
elasticsearch.index.loader@metric:
  load_mode: "LoadWithCache"
  index_reload_interval: "1m"
  query_index_time_range: true
  cache_key_prefix: "es-index-metric"
  match:
    - prefix: "spot-"
      patterns:
        - "empty"
        - "<metric>-<namespace>.<key>-r-{number}"
        - "<metric>-<namespace>-r-{number}"
        - "<metric>-<namespace>-m-{}"
        - "<metric>-<namespace>-m-{}"
        - "<metric>-<namespace>.<key>-<timestamp>"
        - "<metric>-<namespace>-<timestamp>"
        - "<metric>-<namespace>.<key>"
        - "<metric>-<namespace>"
storage-retention-strategy@metric:
  default_ttl: "${LOG_TTL:168h}"
  load_from_database: true
  ttl_reload_interval: "3m"
elasticsearch.index.retention-strategy@metric:
  key_patterns: 
    - "spot-<metric>-<namespace>.<key>-r-{number}"
    - "spot-<metric>-<namespace>.<key>-<timestamp>"
elasticsearch.index.cleaner@metric:
  check_interval: "30m"
  print_onluy: true
  disk_clean:
    enable: ${METRIC_DISK_CLEAN_ENABLE:true}
    check_interval: "1m"
    high_disk_usage_percent: ${HIGH_DISK_USAGE_PERCENT:80} # 触发磁盘清理的容量占比
    low_disk_usage_percent: ${LOW_DISK_USAGE_PERCENT:70} # 触发磁盘清理时，尽量清理到的目标容量占比
    min_indices_store: "${MIN_INDICES_STORE_SIZE:10GB}" # 磁盘使用率高时，保证 索引最少可以占用的容量
    min_indices_store_percent: ${MIN_INDICES_STORE_PERCENT:10} # 磁盘使用率高时，保证 索引最少可以占用总磁盘总量的百分比
    rollover_body_file: "${CONFIG_PATH}/index_rollover_min.json"
    rollover_alias_patterns:
      - index: "spot-<metric>-<namespace>-r-{number}"
        alias: "spot-<metric>-<namespace>-rollover"
      - index: "spot-<metric>-<namespace>.<key>-r-{number}"
        alias: "spot-<metric>-<namespace>.<key>-rollover"
erda.core.monitor.metric:
  chart_meta:
    path: ${CONFIG_PATH}/charts
    reload_interval: "30s"
  metric_meta:
    sources:
      - "index"
      - "file"
      - "database"
    group_files:
      - "${CONFIG_PATH}/metricmeta/groups/org.yml"
      - "${CONFIG_PATH}/metricmeta/groups/micro_service.yml"
    metric_meta_path: "${CONFIG_PATH}/metricmeta/metrics"

metric-query-example:
  _enable: ${METRIC_QUERY_EXAMPLE_ENABLE:false}
metrics-query-compatibility:
  _enable: ${METRIC_QUERY_ENABLE:true}
  chart_meta:
    path: ${CONFIG_PATH}/charts

erda.core.monitor.alertdetail:

logs-index-query:
  query_back_es: ${LOGS_QUERY_BACK_ES:false}
  index_field_settings:
    file: ${CONFIG_PATH}/logs/default_field_settings.yml
log-metric-rules:
node-topo:
#apm providers
apm-runtime:
apm-topology:
  cassandra:
    keyspace:
      name: "spot_prod"
      replication:
        class: ${CASSANDRA_KEYSPACE_REPLICATION_CLASS:SimpleStrategy}
        factor: ${CASSANDRA_KEYSPACE_REPLICATION_FACTOR:2}
apm-report:

erda.core.monitor.alert:
  #  micro_service_filter_tags: "${MICRO_SERVICE_FILTER_TAGS:metric_name,_metric_name,metric_scope,_metric_scope,metric_scope_id,_metric_scope_id,cluster_name,host_ip,org_id,org_name,project_id,project_name,application_id,application_name,runtime_id,runtime_name,service_id,service_name,component_name,addon_name,workspace,cpu_request,cpu_limit,cpu_origin,mem_request,mem_limit,mem_origin,job_id,addon_id,instance_id,instance_type,edas_app_id,edas_app_name,edas_group_id,pod_name,pod_namespace,pod_ip,terminus_key}"
  micro_service_filter_tags: "${MICRO_SERVICE_FILTER_TAGS:_metric_name,_metric_scope,_metric_scope_id}"
  #  org_filter_tags: "${ORG_FILTER_TAGS:size,platform_addon,os,kernel_version,container_id,version,is_edge,login_callback,namespace,app_config_namespace,container_name,container_image,http_port,image_version,deployment,ssh_user,deployment_id,email_smtp_port,openapi_addr,ingress_version,email_smtp_is_ssl,openapi_token_for_action_bootstrap,email_smtp_host,ssh_password,email_smtp_display_user,metric_name,_metric_name,metric_scope,_metric_scope,metric_scope_id,_metric_scope_id,org_id,org_name,component_name,addon_name,workspace,cpu_request,cpu_limit,cpu_origin,mem_request,mem_limit,mem_origin,edas_app_id,edas_app_name,edas_group_id,pod_name,pod_namespace,pod_ip,terminus_key,root_domain,email_smtp_username,inside,email_smtp_username,cluster_type,protocol,email_smtp_password,storage_mountpoint,terminus_version,email_smtp_display_user,openapi_public_url}"
  org_filter_tags: "${ORG_FILTER_TAGS:_metric_name,_metric_scope,_metric_scope_id}"
  micro_service_other_filter_tags: "${MICRO_SERVICE_OTHER_FILTER_TAGS:application_id}"
  silence_policy: "${SILENCE_POLICY:fixed,doubled}"
  cassandra:
    session:
      keyspace:
        name: "spot_prod"
    gc_grace_seconds: 86400

report-apis:
  pipeline:
    version: "1.1"
    action_type: "reportengine"
    action_version: "1.0"
  report_cron:
    daily_cron: "0 9 * * *"
    weekly_cron: "0 9 * * 1"
    monthly_cron: "0 20 * * *"
  cluster_name: "${DICE_CLUSTER_NAME}"

org-apis:
  offline_timeout: "${DASHBOARD_OFFLINE_TIMEOUT:3s}"
  offline_sleep: "${DASHBOARD_OFFLINE_SLEEP:3m}"
runtime-apis:
project-apis:
erda.core.monitor.settings:
erda.core.monitor.dataview:
dataview-v1:
template:

i18n:
  common:
    - conf/common/i18n/common.yml
    - conf/common/i18n/apis.yml
  files:
    - ${CONFIG_PATH}/i18n/settings.yml
    - ${CONFIG_PATH}/i18n/org-resource.yml
    - ${CONFIG_PATH}/i18n/alert.yml
    - ${CONFIG_PATH}/i18n/log-metrics.yml
    - ${CONFIG_PATH}/i18n/charts.yml
    - ${CONFIG_PATH}/i18n/topology.yml
i18n@metric:
  common:
    - ${CONFIG_PATH}/metricmeta/i18n/_common.yml
  files:
    - ${CONFIG_PATH}/metricmeta/i18n

notify-query:
  files:
    - ${CONFIG_PATH}/notify/notify

# admin
http-server@admin:
  addr: ":7098"
pprof:
prometheus:

monitor-monitoring:
  usage_sync_interval:
    metric: ${MONITOR_MONITORING_METRIC_SYNC_INTERVAL:1h}
    log: ${MONITOR_MONITORING_LOG_SYNC_INTERVAL:30m}
