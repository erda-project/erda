{
  "attributes": {},
  "version": "3.0",
  "expression": {
    "metric": "span",
    "window": 3,
    "filter": {},
    "group": [
      "trace_id"
    ],
    "functions": [
      {
        "field": "start_time",
        "alias": "start_time",
        "aggregator": "min"
      },
      {
        "field": "end_time",
        "aggregator": "max",
        "alias": "end_time"
      },
      {
        "field": "components",
        "aggregator": "distinct",
        "alias": "components",
        "field_script": "function invoke(field, tag){ if(tag.span_layer=='http' || tag.span_layer=='rpc') return tag.service_name; return tag.component; }"
      },
      {
        "field": "errors",
        "aggregator": "sum",
        "field_script": "function invoke(field, tag){ return tag.error=='true'?1:0; }"
      },
      {
        "field": "applications",
        "aggregator": "distinct",
        "alias": "application_names",
        "field_script": "function invoke(field, tag){ return tag.application_name; }"
      },
      {
        "field": "applications_ids",
        "aggregator": "distinct",
        "alias": "applications_ids",
        "field_script": "function invoke(field, tag){ return tag.application_id; }"
      },
      {
        "field": "service_names",
        "aggregator": "distinct",
        "alias": "service_names",
        "field_script": "function invoke(field, tag){ return tag.service_name; }"
      },
      {
        "field": "service_ids",
        "aggregator": "distinct",
        "alias": "service_ids",
        "field_script": "function invoke(field, tag){ return tag.service_id; }"
      },
      {
        "field": "dubbo_methods",
        "aggregator": "distinct",
        "alias": "dubbo_methods",
        "field_script": "function invoke(field, tag){ return tag.dubbo_method; }"
      },
      {
        "field": "http_paths",
        "alias": "http_paths",
        "aggregator": "distinct",
        "field_script": "function invoke(field, tag){ return tag.http_path; }"
      },
      {
        "field": "terminus_keys",
        "alias": "terminus_keys",
        "aggregator": "distinct",
        "field_script": "function invoke(field, tag){ return tag.terminus_key; }"
      }
    ],
    "select": {
      "trace_id": "#trace_id",
      "org_id": "#org_id",
      "org_name": "#org_name",
      "cluster_name": "#cluster_name",
      "project_id": "#project_id",
      "project_name": "#project_name",
      "workspace": "#workspace"
    },
    "alias": "trace",
    "outputs": [
      "metric"
    ]
  }
}