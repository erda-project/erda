{
  "attributes": {},
  "version": "3.0",
  "expression": {
    "metric": "analyzer-alert",
    "window": 8,
    "windowBehavior": "allowedLateness",
    "filters": [
      {
        "tag": "alert_type",
        "operator":"eq",
        "value": "kubernetes"
      }
    ],
    "group": [
      "cluster_name",
      "component_name"
    ],
    "functions": [
      {
        "field": "__level",
        "field_script": "function invoke(field,tag){if(tag.level===\"FATAL\"){return 2}return 1}",
        "aggregator": "max",
        "alias": "health_status"
      },
      {
        "field": "__weight",
        "aggregator": "value",
        "field_script": "function invoke(field,tag){if(!tag.component_name){return 0}var a=[\"calico\",\"coredns\",\"kube-apiserver\",\"kube-controller-manager\",\"kube-etcd\",\"kube-proxy\",\"kube-scheduler\",\"nginx-ingress-controller\"];for(var i=0;i<a.length;i++){if(tag.component_name.indexOf(a[i])!==-1){return 1}}return 0}",
        "alias": "weight"
      }
    ],
    "select": {
      "_meta": "#_meta",
      "_metric_scope": "#_metric_scope",
      "_metric_scope_id": "#_metric_scope_id",
      "component_name": "#component_name",
      "cluster_name": "#cluster_name",
      "org_name": "#org_name",
      "org_id": "#dice_org_id",
      "component_group": "kubernetes",
      "message": "#alert_name"
    },
    "alias": "leaf_component_status",
    "outputs": [
      "metric"
    ]
  }
}