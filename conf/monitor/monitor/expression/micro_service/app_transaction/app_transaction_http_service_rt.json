{
  "name": "服务HTTP慢事务异常",
  "alert_scope": "micro_service",
  "attributes": {
    "level": "Notice",
    "recover": "true",
    "display_url_id": "micro_si_web",
    "alert_group": "{{target_terminus_key}}-{{target_runtime_id}}-{{target_service_name}}",
    "tickets_metric_key": "{{target_application_id}}"
  },
  "template": {
    "metric": "application_http",
    "window": 1,
    "filters": [
      {
        "tag": "target_terminus_key",
        "operator": "eq",
        "value": "$terminus_key"
      }
    ],
    "group": [
      "target_runtime_id",
      "target_service_name"
    ],
    "functions": [
      {
        "field": "elapsed",
        "aggregator": "sum",
        "field_script": "function invoke(field, tag){ return field.elapsed_sum / 1000000; }"
      },
      {
        "field": "elapsed_count",
        "aggregator": "sum"
      },
      {
        "aggregator": "value",
        "field": "elapsed_avg",
        "field_script": "function invoke(field, tag){ if(!field.elapsed_count_sum) return 0; return field.elapsed_count_sum === 0 ? 0 : (field.elapsed_sum / field.elapsed_count_sum);}",
        "trigger": "aggregated",
        "operator": "gte",
        "value": 1000
      }
    ],
    "condition": "and",
    "select": {
      "application_name": "#target_application_name",
      "project_id": "#target_project_id",
      "project_name": "#target_project_name",
      "runtime_id": "#target_runtime_id",
      "runtime_name": "#target_runtime_name",
      "service_name": "#target_service_name",
      "terminus_key": "#target_terminus_key",
      "workspace": "#target_workspace"
    },
    "outputs": [
      "alert"
    ]
  }
}
