{
  "name": "MySQL实例主从同步异常告警",
  "alert_scope": "org",
  "attributes": {
    "level": "Warning",
    "recover": "true",
    "alert_group": "{{cluster_name}}-{{addon_id}}",
    "tickets_metric_key": "{{addon_id}}"
  },
  "template": {
    "metric": "mysql",
    "window": 1,
    "filters": [
      {
        "tag": "org_name",
        "operator": "eq",
        "value": "$org_name"
      },
      {
        "tag": "is_slave",
        "operator": "eq",
        "value": "true"
      }
    ],
    "group": [
      "addon_id",
      "server"
    ],
    "functions": [
      {
        "aggregator": "max",
        "alias": "slave_slave_running_ok_value",
        "field": "slave_slave_running_ok",
        "field_script": "function invoke(fields,tags){return (fields.slave_slave_io_running==0 || fields.slave_slave_sql_running==0)?0:1}",
        "operator": "neq",
        "value": 1
      },
      {
        "aggregator": "max",
        "alias": "slave_slave_sql_running_value",
        "field": "slave_slave_sql_running"
      },
      {
        "aggregator": "max",
        "alias": "slave_slave_io_running_value",
        "field": "slave_slave_io_running"
      }
    ],
    "select": {
      "cluster_name": "#cluster_name",
      "host_ip": "#host_ip",
      "addon_id": "#addon_id",
      "org_name": "#org_name"
    },
    "outputs": [
      "alert"
    ]
  }
}
