// Copyright (c) 2021 Terminus, Inc.
//
// This program is free software: you can use, redistribute, and/or modify
// it under the terms of the GNU Affero General Public License, version 3
// or later ("AGPL"), as published by the Free Software Foundation.
//
// This program is distributed in the hope that it will be useful, but WITHOUT
// ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
// FITNESS FOR A PARTICULAR PURPOSE.
//
// You should have received a copy of the GNU Affero General Public License
// along with this program. If not, see <http://www.gnu.org/licenses/>.

package main

import (
	"context"
	"log"

	metav1 "k8s.io/apimachinery/pkg/apis/meta/v1"

	"github.com/erda-project/erda/apistructs"
	"github.com/erda-project/erda/pkg/k8sclient"
	"github.com/erda-project/erda/pkg/k8sclient/config"
	"github.com/erda-project/erda/pkg/k8sclient/scheme"
)

func main() {

	//token := "eyJhbGciOiJSUzI1NiIsImtpZCI6IjF1eVZTMVlSbDJsd1hyb0kzdE1pd1U3TlNYX1FkdURnWDZOdE4tcGQ0ZjgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRpY2Utb3BlcmF0b3ItdG9rZW4tYzY1d2MiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGljZS1vcGVyYXRvciIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6ImFmNTk4ZTQwLTE1MWUtNDI3ZC1hZTEyLTIzZTczOGQwYTgzZiIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRpY2Utb3BlcmF0b3IifQ.oyoepsJmIwE9Y8FJ5H3FODRrb7YLru3nbjvn1xmcTuQ4ggt10DotmCrBcPOyUqgtrYT069FKOMNXLJpEaVP_T1vDEK7FWL9JJkUlVbyKWuAc2lrivbXcmTwozl0wpMVelc5w9ENYnRVlIx82gyHuepCHyAUmpOsHryBr5_dhYVPdjoJJKD-pDBBs2t9ULgziM6CbahVkkzdcV95ACeA__H8UY0HRR_bqkNro90GqzphAi4vN7flnHVwvZcxny6OUJRIRv5VAzxueD1Ju85Txq6Go3FkYbHYoT_KeH5j_G0SUqy8PdvMXxFB9-7tuciZpOJ7cZ3lKX4HSBYUZad3WRg"
	//
	//rc, err := config.GetDialerRestConfig("terminus-test", &apistructs.ManageConfig{
	//	Type:    apistructs.ManageProxy,
	//	Token:   token,
	//	Address: "10.96.0.1:443",
	//})

	rc, err := config.GetRestConfig(&apistructs.ManageConfig{
		Type:     apistructs.ManageCert,
		CertData: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURUekNDQWplZ0F3SUJBZ0lVTnQ5ZlVKRnBiRk85OW9mTlI3K1Y1Z25MeHJjd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dERVdNQlFHQTFVRUF4TU5hM1ZpWlhKdVpYUmxjeTFqWVRBZUZ3MHlNVEEwTWpNd01EVTJNREJhRncwMApPREE1TURnd01EVTJNREJhTURReEZ6QVZCZ05WQkFvVERuTjVjM1JsYlRwdFlYTjBaWEp6TVJrd0Z3WURWUVFECkV4QnJkV0psY201bGRHVnpMV0ZrYldsdU1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0MKQVFFQTI2V01wRk5iZzZCUmJFbDlYd1dzZVd1V28rbEFaVTFad1BrZUw3bE1ZUzFrd0dLQmUxKys0Z21mV0E4dAoyd0UxcFp0cDB2SGhhWlFWWG5wTDhJK2NUQVZIR2kxOUpKaDRwSHo4dWFUSHBpUjcyNlRXdTc4N1FOM3pMY2JnCmwzSXRDU3Z2TmJZUjc4cXJuMjRIdUd3TjhKOE5NY0tSR0Z3dWo3WXpGMXFaSkMrRTJIS2c0NUMzZVJEZHVPamQKamhEakhvbE5PYU5HRXh1SU5JSVlIK0JqSE1YVFlOZHMxdWdhL0hOVW1NQ053R3JiZFA3RjY2ZWh1aDZJdXN3TAp6L01IaU9NK0IrS29hY2ZCWW9nbUdhVTk0VC9qaHZXRHR2ZGh6Ujg0NHU1YVV1b1dNYWFSSW1zWXcrWHdhRW5kCjV3Ukk3WEJHK0hUaHJDZzBWMEFKQnBkZC9RSURBUUFCbzNVd2N6QU9CZ05WSFE4QkFmOEVCQU1DQmFBd0V3WUQKVlIwbEJBd3dDZ1lJS3dZQkJRVUhBd0l3REFZRFZSMFRBUUgvQkFJd0FEQWRCZ05WSFE0RUZnUVVXWkFYOHgxNApFNzJMNGdudWJmSjlVeGFPbnBzd0h3WURWUjBqQkJnd0ZvQVVKNExNL1IwdFk3K2hKcXZSQjZjMDd5c3gvelF3CkRRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFEMHg5enZCTGJIcjJjZEtmZE9JakxRcThDWmNveUp1aDBpL2pob2wKUCtKOHdWOVNBdUU4VDBNdXN3SjRWdTErWjNtNVFjLzVjbnpueVV3SCtFbWw4ZnQ0SnZoTTV5a3NWalhMQ1ZHMwpwRlpvUVRrQllDS0VyeldHUk5VNGVGakwwL0FlS214WHRJU2pUNnJsdm9SS0s1bXo5WHREb1cyN0JEb3Z1UTJSCjMrRlBkK1d1V3hiUzRZSXJuNFlRc2s3dGl1NnlROWdKTHAyN3Q1K2pHc1NtUlNzNHNyaWFRM1NJOUVGc202cEcKQ3ZkUmVUdnplMVp4RzlRMTJSUy9VVkFoenhZLzZOT1RTd25xdkthV2JYcUk3R29nVFc5S2pLdDMwajVXTHppZgoyNXZXd1FHbHAwRC85R01IeVAvUGhxRzMvbVl4dThJNVhMY2lJcnpaNTZjQkh4Yz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
		KeyData:  "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBMjZXTXBGTmJnNkJSYkVsOVh3V3NlV3VXbytsQVpVMVp3UGtlTDdsTVlTMWt3R0tCCmUxKys0Z21mV0E4dDJ3RTFwWnRwMHZIaGFaUVZYbnBMOEkrY1RBVkhHaTE5SkpoNHBIejh1YVRIcGlSNzI2VFcKdTc4N1FOM3pMY2JnbDNJdENTdnZOYllSNzhxcm4yNEh1R3dOOEo4Tk1jS1JHRnd1ajdZekYxcVpKQytFMkhLZwo0NUMzZVJEZHVPamRqaERqSG9sTk9hTkdFeHVJTklJWUgrQmpITVhUWU5kczF1Z2EvSE5VbU1DTndHcmJkUDdGCjY2ZWh1aDZJdXN3THovTUhpT00rQitLb2FjZkJZb2dtR2FVOTRUL2podldEdHZkaHpSODQ0dTVhVXVvV01hYVIKSW1zWXcrWHdhRW5kNXdSSTdYQkcrSFRockNnMFYwQUpCcGRkL1FJREFRQUJBb0lCQUJYTzR4N3hzOVZtMW83RQo0VERORkduZDE5QWdlYWRWUGNNZU9QUU9GdHBUTW55eml4MmZ6UWtPWVliUnd3REtwdlB4Y1ZsamNMa1YzZVZLCmlUMnlWSmRyc3JxVHA2ZzVoMGoxcS9ZV3VVZnl1V1YrZ1YrVXhpSlRwekIxWFpsTDJkTGVUTnJ0WCt5S0YrNDEKYzRqSkdiMDVYWXNDUVh2RXMwN0xqVmtWUXIxSDExNDhOMWVJYXJyWjVGbkg4dVBHdDZLNWhJOXlsVHlYekZWMgpDZDc4WUw4U3NYTENCS2JYdzNpOGVSZForSEZWUnprSHVCa1JvcC9LTHNEOUxnUDdSZC9XOE8xZGxtQjVPcCtBCnlZbm5DYXVtQzFLL3ZtTXFTWEMreWc1UXoycFFTYzlwUjNRWGhma3dyWmhhNXRDVTltWlJQbDQ5anNldVpsWTgKekdlSGE5VUNnWUVBL09SSFk3T0ZuUG93Q3ZRcVlLZU8yVVgzOUpEeTFIR3pvSytnelczSWFnVHc5NlZmaFlzSgprT0x6QStvYkRJNW1tL1pYZnJMektaSWhpZG9ac3RtSU4vdTNuRGZuYWx0MThtcVprVHhnb2d2SGdiSDh0R2c5CnkyOGw3NzNudGVOR3hUekMyY0RMbUE4cEU0a0FJaTk0eDhlNXNDUFY5MGF4MnRZK3hFT3FzcU1DZ1lFQTNsaXEKVk1OMzM5MTR5MktTeXFiSitxNkxVTlRKUi8vZGdGQnNGQUpOZlMvR0M0NENmWGlmMnRsK1d0YmtKVWVxY25oYwpaNlhaMFRYWUpsN2VyNkNQcEFqVWs2MHV3R1QzZVpFblk5c3BBZHhUdDE2KzdwYVRvenNSY3g1aDR6aXdRVVZYClJSUFlKeXlnbFlzZGk1VVhBMGZNTTFDaFpMTzArMVUyTXJEQlZ0OENnWUEvVzJXelNjK29zMW1EOVFZRTd4V3YKdzRMS2grSCtiWG9HUU5uMWZaS2ZWUnVWdjUyOTFFYVNRUG1IT29pS1RjYlJQaGRQaTcrMTQ0RjVpdVd6VkNKMwpmQjNWQ29CMHVmTkR4NGN2eHNPaTlYYUhQTE5GODNPLzJ0blRSVzJldVJFSzZ4MFo5dDVLKzBsY05vK05BUDJ1CmQ1QkMyOGVJU3ZMV0U2VG9BTmZzSndLQmdDUW41T0xOdWxPRDd4MmJsT1V4UkF6b2p5MEF2UTVoTkFLbWtUeWIKdDBBUkliSkZVSEJZeWgzTFdqbXBVZ1loNWp5aEI5MnU0WUdjc041a2RPKzRPME5nVURrSFkxL1R5MDVRWlVoZQpuZ2Q0YllDVy9wTkxsd3huRVlwWHVYRTZpYWJEZ05KeHpLZHFJVjdQOVdqNlFIaS9GeHlORXdHT0czTDNRMDN3CjRpK2ZBb0dBQXBRS3V2TzBnMGFwcDZWOFJkd2JBaWFtVlZFcFlHM2U3NWpxRzBncUVLU01PUFJBWUZuWG5FWUEKNVNPaUVWdFBHLzdySFlaWEZWemhVZDdtZlNiTkh2WWRiQnVjQ1dGQytsdjA5R3Z5dzhFd25jT1hCVzJwYUcxagpKa1FpbE9ORnZUR2Q0WkNYVWZlMDQzS3lMOG83bWRsZ291cU1heG1IYnhDUUlLVUlLT1E9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==",
		Address:  "https://10.0.6.198:6443",
		CaData:   "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURKRENDQWd5Z0F3SUJBZ0lVQjJiek5Sckp3ekE4NzRmcEc3N3o5UTlORkpVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dERVdNQlFHQTFVRUF4TU5hM1ZpWlhKdVpYUmxjeTFqWVRBZUZ3MHlNVEEwTWpNd01EVTJNREJhRncwMApPREE1TURnd01EVTJNREJhTUJneEZqQVVCZ05WQkFNVERXdDFZbVZ5Ym1WMFpYTXRZMkV3Z2dFaU1BMEdDU3FHClNJYjNEUUVCQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUUNYV3BEc2R4MVhLWitEK0Zjb1dibCttYnBWd1FPWng4NmwKWGtjZERhM05icDJkT3pqNHNCUU9HanYzcGk1RXZzOEszVEV3emlmQ1dRQzZOS2NNUGZiQTFvTlptUUZ6Y0ZwSwpjWTNnMDhVbUxPbHhwZWtRTkJWdmk0WXI1S1A2a2xxQ1p5SkZkeXVGOW5JckhMN1E1RVIvRTNwcmMwbGhmMHBXCm5XS1Y3NVplek53NDhYVzhQZ0tUUjMyN2pQeEx5eG1yQ01PSGZwN2k5b3hEL1NkbHdaTkJ6alJWOG4zUXN2L1oKMzNuSGhQZFI3MUV3a1FtTjB4Yi9mT244SnFoanVCdXRxejRHN1Bxc055N2M1bmhlVVY0Mnc0Tk9SMHpDY1ZKZQo0N3FNRzQ5RW1WTG05MmVTYXhocmVsWHlsNXBrMVpzTG8zN2o5T05RTVpJTmo0MmFJLzBYQWdNQkFBR2paakJrCk1BNEdBMVVkRHdFQi93UUVBd0lCQmpBU0JnTlZIUk1CQWY4RUNEQUdBUUgvQWdFQ01CMEdBMVVkRGdRV0JCUW4KZ3N6OUhTMWp2NkVtcTlFSHB6VHZLekgvTkRBZkJnTlZIU01FR0RBV2dCUW5nc3o5SFMxanY2RW1xOUVIcHpUdgpLekgvTkRBTkJna3Foa2lHOXcwQkFRc0ZBQU9DQVFFQVVvK1BuQVpYdVZWaElhRmphTENZSnBzUis4MDY2WHlqCkpsQ2lFSnc4YVRiQjI3ZVVXZTUrYU4yL2NrZFpWc3R5WHVnZ2RVRkdkeTJiOXhsbitwdjgwZSsxbkpHRDRGZTkKQUZQNUt6L09BbWMyZlQ5Y0Z4TmNXRjRPYUZRWmZ5ampUb0JLWjA3VXpMNXJsbVRJZUtsNCtnUnhYbXJYWmY3bgpMZGV4bjVwL2pKU29tTXV5OXU0QjVkSkZGOVdKSW4vcmZiYmtwN0pJclRMam9seFNoS1p4cFBXUk5ZWCsvRk1hCjZBTitwZkJsTTFLbUpkUEd2d3NhYzBHUExndUxJaXBpNTVoMXhZRDhPN25nZzNzSFBaVnk2b1FDS3BsZjB3M2oKT0crYVh4QU5PVDhweG5SMDBJWldZYThKdW85NC9peWFKTGs2d2JMeFZIb25WWU93UVNZNlVBPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
	})
	if err != nil {
		log.Fatal(err)
	}

	k, err := k8sclient.NewForRestConfig(rc, scheme.LocalSchemeBuilder...)
	if err != nil {
		log.Fatal(err)
	}
	pods, err := k.ClientSet.CoreV1().Pods("default").List(context.Background(), metav1.ListOptions{})
	if err != nil {
		log.Fatal(err)
	}
	log.Println(len(pods.Items))
}
