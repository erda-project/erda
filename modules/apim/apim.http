### health
GET {{apim}}/health

### api-asset 创建
POST {{apim}}/api/api-assets
User-ID: 2
Content-Type: application/json

{
  "assetID": "apim-API",
  "assetName": "apim API",
  "orgID": 1,
  "versions": [
    {
      "majorVersion": 1,
      "minorVersion": 2,
      "patchVersion": 3,
      "specProtocol": "oas2-yaml",
      "spec": "{\n  \"swagger\": \"2.0\",\n  \"info\": {\n    \"title\": \"New API\",\n    \"version\": \"1.0\"\n  },\n  \"paths\": {\n    \"/api/api-management/assets\": {\n      \"get\": {\n        \"operationId\": \"API 资源列表\",\n        \"parameters\": [\n          {\n            \"name\": \"pageNo\",\n            \"required\": true,\n            \"in\": \"query\",\n            \"type\": \"integer\",\n            \"format\": \"int\"\n          },\n          {\n            \"name\": \"pageSize\",\n            \"required\": true,\n            \"in\": \"query\",\n            \"type\": \"integer\",\n            \"format\": \"int\"\n          },\n          {\n            \"name\": \"searchKey\",\n            \"description\": \"搜索关键词\",\n            \"in\": \"query\",\n            \"type\": \"string\"\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"\",\n            \"x-amf-mediaType\": \"application/json\",\n            \"schema\": {\n              \"type\": \"object\",\n              \"additionalProperties\": true,\n              \"required\": [\n                \"success\",\n                \"data\"\n              ],\n              \"properties\": {\n                \"success\": {\n                  \"example\": true,\n                  \"type\": \"boolean\"\n                },\n                \"err\": {\n                  \"type\": \"object\",\n                  \"additionalProperties\": true,\n                  \"required\": [\n                    \"code\",\n                    \"msg\"\n                  ],\n                  \"properties\": {\n                    \"code\": {\n                      \"example\": \"Example\",\n                      \"type\": \"string\"\n                    },\n                    \"msg\": {\n                      \"example\": \"Example\",\n                      \"type\": \"string\"\n                    }\n                  }\n                },\n                \"data\": {\n                  \"type\": \"object\",\n                  \"additionalProperties\": true,\n                  \"required\": [\n                    \"list\",\n                    \"total\"\n                  ],\n                  \"properties\": {\n                    \"list\": {\n                      \"type\": \"array\",\n                      \"items\": {\n                        \"$ref\": \"#/definitions/ApiAsset\"\n                      }\n                    },\n                    \"total\": {\n                      \"example\": 1,\n                      \"type\": \"integer\",\n                      \"format\": \"int\"\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      },\n      \"post\": {\n        \"operationId\": \"创建 API 资源\",\n        \"parameters\": [\n          {\n            \"x-amf-mediaType\": \"application/json\",\n            \"in\": \"body\",\n            \"name\": \"generated\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/CreateApiAssetVersionDto\"\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"\",\n            \"x-amf-mediaType\": \"application/json\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/StandardResult\"\n            }\n          }\n        }\n      }\n    },\n    \"/api/api-management/assets/{assetID}\": {\n      \"get\": {\n        \"operationId\": \"获取资源详情\",\n        \"parameters\": [\n          {\n            \"name\": \"assetID\",\n            \"required\": true,\n            \"in\": \"path\",\n            \"type\": \"string\"\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"\",\n            \"x-amf-mediaType\": \"application/json\",\n            \"schema\": {\n              \"type\": \"object\",\n              \"additionalProperties\": true,\n              \"required\": [\n                \"success\",\n                \"data\"\n              ],\n              \"properties\": {\n                \"success\": {\n                  \"example\": true,\n                  \"type\": \"boolean\"\n                },\n                \"err\": {\n                  \"type\": \"object\",\n                  \"additionalProperties\": true,\n                  \"required\": [\n                    \"code\",\n                    \"msg\"\n                  ],\n                  \"properties\": {\n                    \"code\": {\n                      \"example\": \"Example\",\n                      \"type\": \"string\"\n                    },\n                    \"msg\": {\n                      \"example\": \"Example\",\n                      \"type\": \"string\"\n                    }\n                  }\n                },\n                \"data\": {\n                  \"$ref\": \"#/definitions/ApiAssetDetail\"\n                }\n              }\n            }\n          }\n        }\n      }\n    },\n    \"/api/api-management/assets/{assetID}/versions/{version}\": {\n      \"delete\": {\n        \"operationId\": \"删除指定版本\",\n        \"parameters\": [\n          {\n            \"name\": \"assetID\",\n            \"required\": true,\n            \"in\": \"path\",\n            \"type\": \"string\"\n          },\n          {\n            \"name\": \"version\",\n            \"required\": true,\n            \"in\": \"path\",\n            \"type\": \"string\"\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"\",\n            \"x-amf-mediaType\": \"application/json\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/StandardResult\"\n            }\n          }\n        }\n      }\n    },\n    \"/api/api-management/devops-assets\": {\n      \"post\": {\n        \"operationId\": \"从流水线创建API资源\",\n        \"parameters\": [\n          {\n            \"x-amf-mediaType\": \"application/json\",\n            \"in\": \"body\",\n            \"name\": \"generated\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/CreateOrUpdateFromPipelineDto\"\n            }\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"\"\n          }\n        }\n      }\n    }\n  },\n  \"definitions\": {\n    \"ApiAsset\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"required\": [\n        \"assetID\",\n        \"assetName\",\n        \"logoUrl\",\n        \"description\"\n      ],\n      \"properties\": {\n        \"assetID\": {\n          \"description\": \"限制使用英文和数字的组合\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"assetName\": {\n          \"description\": \"展现名称，可使用任意字符\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"logoUrl\": {\n          \"description\": \"API 资源的 logo\",\n          \"example\": \"://img.exapmle.com\",\n          \"type\": \"string\"\n        },\n        \"description\": {\n          \"description\": \"资源描述\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"CreateApiAssetVersionDto\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"required\": [\n        \"specUrl\",\n        \"logoUrl\",\n        \"assetID\",\n        \"specProtocol\",\n        \"description\",\n        \"assetName\"\n      ],\n      \"properties\": {\n        \"version\": {\n          \"description\": \"必须符合 X.Y.Z  其中X，Y，Z皆为数字\",\n          \"default\": \"1.0.0\",\n          \"example\": \"1.0.0\",\n          \"type\": \"string\"\n        },\n        \"specUrl\": {\n          \"description\": \"API 描述文档上传地址\",\n          \"example\": \"oss://swagger.json\",\n          \"type\": \"string\"\n        },\n        \"logoUrl\": {\n          \"description\": \"API 资源的 logo\",\n          \"example\": \"://img.exapmle.com\",\n          \"type\": \"string\"\n        },\n        \"assetID\": {\n          \"description\": \"限制使用英文和数字的组合\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"specProtocol\": {\n          \"description\": \"API 描述协议\",\n          \"enum\": [\n            \"oas2-json\",\n            \"oas2-yaml\"\n          ],\n          \"example\": \"oas2-json\",\n          \"type\": \"string\"\n        },\n        \"description\": {\n          \"description\": \"资源描述\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"assetName\": {\n          \"description\": \"展现名称，可使用任意字符\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"StandardResult\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"required\": [\n        \"success\"\n      ],\n      \"properties\": {\n        \"success\": {\n          \"example\": true,\n          \"type\": \"boolean\"\n        },\n        \"err\": {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"required\": [\n            \"code\",\n            \"msg\"\n          ],\n          \"properties\": {\n            \"code\": {\n              \"example\": \"Example\",\n              \"type\": \"string\"\n            },\n            \"msg\": {\n              \"example\": \"Example\",\n              \"type\": \"string\"\n            }\n          }\n        }\n      }\n    },\n    \"ApiAssetDetail\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"required\": [\n        \"logoUrl\",\n        \"assetID\",\n        \"versions\",\n        \"description\",\n        \"assetName\"\n      ],\n      \"properties\": {\n        \"logoUrl\": {\n          \"description\": \"API 资源的 logo\",\n          \"example\": \"://img.exapmle.com\",\n          \"type\": \"string\"\n        },\n        \"assetID\": {\n          \"description\": \"限制使用英文和数字的组合\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"versions\": {\n          \"type\": \"object\",\n          \"additionalProperties\": true,\n          \"required\": [\n            \"list\",\n            \"total\"\n          ],\n          \"properties\": {\n            \"list\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"$ref\": \"#/definitions/ApiAssetVersion\"\n              }\n            },\n            \"total\": {\n              \"example\": 1,\n              \"type\": \"integer\",\n              \"format\": \"int\"\n            }\n          }\n        },\n        \"description\": {\n          \"description\": \"资源描述\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"assetName\": {\n          \"description\": \"展现名称，可使用任意字符\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"CreateOrUpdateFromPipelineDto\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"required\": [\n        \"spec\",\n        \"userID\",\n        \"logoUrl\",\n        \"assetID\",\n        \"orgID\",\n        \"runtimeID\",\n        \"specProtocol\",\n        \"description\",\n        \"serviceName\",\n        \"assetName\"\n      ],\n      \"properties\": {\n        \"spec\": {\n          \"description\": \"API 描述文档\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"version\": {\n          \"description\": \"必须符合 X.Y.Z  其中X，Y，Z皆为数字\",\n          \"default\": \"1.0.0\",\n          \"example\": \"1.0.0\",\n          \"type\": \"string\"\n        },\n        \"userID\": {\n          \"description\": \"执行流水线的用户id\",\n          \"example\": 1,\n          \"type\": \"integer\",\n          \"format\": \"int\"\n        },\n        \"logoUrl\": {\n          \"description\": \"API 资源的 logo\",\n          \"example\": \"://img.exapmle.com\",\n          \"type\": \"string\"\n        },\n        \"assetID\": {\n          \"description\": \"限制使用英文和数字的组合\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"orgID\": {\n          \"example\": 1,\n          \"type\": \"integer\",\n          \"format\": \"int\"\n        },\n        \"runtimeID\": {\n          \"description\": \"dice 部署 runtime\",\n          \"example\": 1,\n          \"type\": \"integer\",\n          \"format\": \"int\"\n        },\n        \"specProtocol\": {\n          \"description\": \"API 描述协议\",\n          \"enum\": [\n            \"oas2-json\",\n            \"oas2-yaml\"\n          ],\n          \"example\": \"oas2-json\",\n          \"type\": \"string\"\n        },\n        \"description\": {\n          \"description\": \"资源描述\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"serviceName\": {\n          \"description\": \"dice 服务名\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"assetName\": {\n          \"description\": \"展现名称，可使用任意字符\",\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"ApiAssetVersion\": {\n      \"type\": \"object\",\n      \"additionalProperties\": true,\n      \"required\": [\n        \"version\",\n        \"spec\"\n      ],\n      \"properties\": {\n        \"version\": {\n          \"example\": \"Example\",\n          \"type\": \"string\"\n        },\n        \"spec\": {\n          \"description\": \"api描述文档的内容，暂时使用swagger json进行描述\",\n          \"example\": {\n            \"strict\": true,\n            \"value\": {\n              \"host\": \"openapi-apitestc-d5b7f4.app.terminus.io\",\n              \"securityDefinitions\": {\n                \"ApiKeyAuth\": {\n                  \"in\": \"query\",\n                  \"name\": \"X-API-Key\",\n                  \"type\": \"apiKey\"\n                }\n              },\n              \"paths\": {\n                \"/xml\": {\n                  \"get\": {\n                    \"description\": \"View a sample response in XML format.\",\n                    \"operationId\": \"View XML response\",\n                    \"produces\": [\n                      \"application/xml\"\n                    ],\n                    \"summary\": \"View XML response\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/iloveapis\": {\n                  \"get\": {\n                    \"description\": \"View API affirmation in HTML format.\",\n                    \"operationId\": \"View API affirmation\",\n                    \"produces\": [\n                      \"text/html\"\n                    ],\n                    \"summary\": \"View API affirmation\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/auth\": {\n                  \"get\": {\n                    \"description\": \"Validate access using basic authentication.\",\n                    \"operationId\": \"Validate access using basic authentication\",\n                    \"produces\": [\n                      \"application/json\"\n                    ],\n                    \"summary\": \"Validate access using basic authentication\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/json\": {\n                  \"get\": {\n                    \"description\": \"View a sample response in JSON format.\",\n                    \"operationId\": \"View JSON response\",\n                    \"produces\": [\n                      \"application/json\"\n                    ],\n                    \"summary\": \"View JSON response\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/help\": {\n                  \"get\": {\n                    \"description\": \"View help information about available resources in HTML format.\",\n                    \"operationId\": \"Get help\",\n                    \"produces\": [\n                      \"text/html\"\n                    ],\n                    \"summary\": \"Get help\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/echo\": {\n                  \"get\": {\n                    \"description\": \"View the request headers and body in JSON format.\",\n                    \"operationId\": \"View request headers and body\",\n                    \"produces\": [\n                      \"application/json\"\n                    ],\n                    \"summary\": \"View request headers and body\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  },\n                  \"post\": {\n                    \"security\": [\n                      {\n                        \"ApiKeyAuth\": []\n                      }\n                    ],\n                    \"description\": \"Send a request and view the resulting request headers and body in JSON format.<p>The request payload can be specified using one of the following formats: application/json, application/x-www-form-urlencoded, or application/xml.\",\n                    \"operationId\": \"Send request and view request headers and body\",\n                    \"produces\": [\n                      \"application/json\"\n                    ],\n                    \"consumes\": [\n                      \"application/json\"\n                    ],\n                    \"parameters\": [\n                      {\n                        \"name\": \"body\",\n                        \"in\": \"body\",\n                        \"description\": \"Request payload in application/json, application/x-www-form-urlencoded, or application/xml format.\",\n                        \"schema\": {\n                          \"$ref\": \"#/definitions/request-body\"\n                        },\n                        \"required\": true\n                      },\n                      {\n                        \"description\": \"Your user name.\",\n                        \"in\": \"query\",\n                        \"name\": \"user\",\n                        \"type\": \"string\"\n                      },\n                      {\n                        \"name\": \"item\",\n                        \"in\": \"path\",\n                        \"description\": \"item\",\n                        \"type\": \"string\",\n                        \"required\": true\n                      },\n                      {\n                        \"in\": \"header\",\n                        \"name\": \"X-Request-ID\",\n                        \"required\": true,\n                        \"type\": \"string\"\n                      }\n                    ],\n                    \"summary\": \"Send request and view request headers and body\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\",\n                        \"schema\": {\n                          \"$ref\": \"#/definitions/demo-struct\"\n                        }\n                      }\n                    }\n                  }\n                },\n                \"/user\": {\n                  \"get\": {\n                    \"description\": \"View a personalized greeting for the specified or guest user.\",\n                    \"operationId\": \"View personalized greeting\",\n                    \"produces\": [\n                      \"text/plain\"\n                    ],\n                    \"parameters\": [\n                      {\n                        \"description\": \"Your user name.\",\n                        \"in\": \"query\",\n                        \"name\": \"user\",\n                        \"type\": \"string\"\n                      }\n                    ],\n                    \"summary\": \"View personalized greeting\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/ip\": {\n                  \"get\": {\n                    \"description\": \"View the IP address of the client in JSON format.\",\n                    \"operationId\": \"View IP address\",\n                    \"produces\": [\n                      \"application/json\"\n                    ],\n                    \"summary\": \"View IP address\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                },\n                \"/\": {\n                  \"get\": {\n                    \"security\": [\n                      {\n                        \"ApiKeyAuth\": []\n                      }\n                    ],\n                    \"description\": \"View a personalized greeting for the specified or guest user.\",\n                    \"operationId\": \"View a personalized greeting\",\n                    \"produces\": [\n                      \"text/plain\"\n                    ],\n                    \"parameters\": [\n                      {\n                        \"description\": \"Your user name.\",\n                        \"in\": \"query\",\n                        \"name\": \"user\",\n                        \"type\": \"string\"\n                      }\n                    ],\n                    \"summary\": \"View personalized greeting\",\n                    \"responses\": {\n                      \"200\": {\n                        \"description\": \"Success\"\n                      }\n                    }\n                  }\n                }\n              },\n              \"info\": {\n                \"description\": \"OpenAPI Specification for the Apigee mock target service endpoint.\",\n                \"title\": \"Mock Target API\",\n                \"version\": \"1.0.0\"\n              },\n              \"schemes\": [\n                \"https\"\n              ],\n              \"definitions\": {\n                \"demo-struct\": {\n                  \"properties\": {\n                    \"id\": {\n                      \"description\": \"test\",\n                      \"type\": \"integer\"\n                    },\n                    \"name\": {\n                      \"type\": \"string\"\n                    }\n                  }\n                },\n                \"request-body\": {\n                  \"properties\": {\n                    \"replace-me\": {\n                      \"description\": \"Replace with request payload in application/json, application/x-www-form-urlencoded, or application/xml format.\",\n                      \"properties\": {\n                        \"name\": {\n                          \"type\": \"string\"\n                        },\n                        \"demo\": {\n                          \"$ref\": \"#/definitions/demo-struct\"\n                        },\n                        \"id\": {\n                          \"type\": \"integer\"\n                        },\n                        \"demoArray\": {\n                          \"items\": {\n                            \"$ref\": \"#/definitions/demo-struct\"\n                          },\n                          \"type\": \"array\"\n                        },\n                        \"demoObj\": {\n                          \"properties\": {\n                            \"id\": {\n                              \"type\": \"integer\"\n                            },\n                            \"name\": {\n                              \"type\": \"string\"\n                            }\n                          },\n                          \"type\": \"object\"\n                        }\n                      },\n                      \"type\": \"object\"\n                    }\n                  }\n                }\n              },\n              \"swagger\": \"2.0\"\n            }\n          },\n          \"type\": \"object\",\n          \"additionalProperties\": true\n        }\n      }\n    }\n  }\n}\n",
      "specDiceFileUUID": "9b1223402dfa4643866dd4e19ee41d70",
      "instances": [
        {
          "instanceType": "service",
          "runtimeID": 1,
          "serviceName": "demo3"
        },
        {
          "instanceType": "service",
          "name": "xxx",
          "runtimeID": 2,
          "serviceName": "pampas-blog"
        }
      ]
    }
  ]
}

### api-asset 查询
GET {{apim}}/api/api-assets/apim-API
User-ID: 2
Org-ID: 1

### api-asset 分页查询
GET {{apim}}/api/api-assets?assetName=api
User-ID: 2
Org-ID: 1

### api-asset versions 列表查询
GET {{apim}}/api/api-assets/apim-API/versions
User-ID: 2
Org-ID: 1

### api-asset version 详情
GET {{apim}}/api/api-assets/devops-api-asset-4/versions/80
User-ID: 2
Org-ID: 1
