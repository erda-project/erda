{
  "name": "Elasticsearch实例内存使用率异常告警",
  "alert_scope": "org",
  "attributes": {
    "level": "WARNING",
    "recover": "false",
    "alert_group": "{{cluster_name}}-{{container_id}}",
    "tickets_metric_key": "{{container_id}}"
  },
  "template": {
    "metric": "docker_container_summary",
    "window": 1,
    "filters": [
      {
        "tag": "cluster_name",
        "operator": "in",
        "value": ["$cluster_name"]
      },
      {
        "tag": "addon_type",
        "operator": "in",
        "value": ["terminus-elasticsearch", "elasticsearch-operator"]
      }
    ],
    "group": [
      "container_id"
    ],
    "functions": [
      {
        "aggregator": "avg",
        "field": "mem_usage_percent",
        "operator": "gte",
        "value": 90
      },
      {
        "aggregator": "max",
        "alias": "mem_limit_value",
        "field": "mem_limit"
      },
      {
        "aggregator": "max",
        "alias": "mem_allocation_value",
        "field": "mem_allocation"
      }
    ],
    "select": {
      "cluster_name": "#cluster_name",
      "host_ip": "#host_ip",
      "addon_id": "#addon_id",
      "addon_type": "#addon_type",
      "container_id": "#container_id",
      "pod_name": "#pod_name",
      "pod_namespace": "#pod_namespace"
    },
    "outputs": [
      "alert"
    ]
  }
}