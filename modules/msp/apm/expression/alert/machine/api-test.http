@url = http://monitor.default.svc.cluster.local:7096
@notify_group_id = 1
@dingding = https://oapi.dingtalk.com/robot/send?access_token=6b41bccea053dff5362b15088485849a4d5e2c701d2f18c4e61e14b41ca0715b
@org_id = 1
@user_id = 1
@domain = http://terminus.app.terminus.io


### 删除 alert
DELETE {{url}}/api/alerts/<id>


### 机器CPU
# @ machine/machine_cpu
POST {{url}}/api/orgs/alerts
Content-Type: application/json
Org-ID: {{org_id}}
User-ID: {{user_id}}

{
	"alertScope": "org",
	"alertScopeId": "1",
	"clusterName": "terminus-dev",
	"domain": "http://terminus.app.terminus.io",
	"enable": true,
	"name": "机器CPU",
	"notifies": [
		{
			"dingdingUrl": "{{dingding}}",
			"type": "dingding"
		}
	],
	"rules": [
		{
			"alertIndex": "machine_cpu",
			"functions": [
				{
					"aggregator": "avg",
					"field": "usage_active",
					"operator": "gte",
					"value": 95
				}
			],
			"window": 1
		}
	]
}



### 机器磁盘
# @ machine/machine_disk
POST {{url}}/api/orgs/alerts
Content-Type: application/json
Org-ID: {{org_id}}
User-ID: {{user_id}}

{
	"alertScope": "org",
	"alertScopeId": "1",
	"clusterName": "terminus-dev",
	"domain": "http://terminus.app.terminus.io",
	"enable": true,
	"name": "机器磁盘",
	"notifies": [
		{
			"dingdingUrl": "{{dingding}}",
			"type": "dingding"
		}
	],
	"rules": [
		{
			"alertIndex": "machine_disk",
			"functions": [
				{
					"aggregator": "value",
					"field": "used_percent",
					"operator": "gte",
					"value": 86
				}
			],
			"window": 1
		}
	]
}



### 机器磁盘IO
# @ machine/machine_disk_util
POST {{url}}/api/orgs/alerts
Content-Type: application/json
Org-ID: {{org_id}}
User-ID: {{user_id}}

{
	"alertScope": "org",
	"alertScopeId": "1",
	"clusterName": "terminus-dev",
	"domain": "http://terminus.app.terminus.io",
	"enable": true,
	"name": "机器磁盘IO",
	"notifies": [
		{
			"dingdingUrl": "{{dingding}}",
			"type": "dingding"
		}
	],
	"rules": [
		{
			"alertIndex": "machine_disk_util",
			"functions": [
				{
					"aggregator": "min",
					"field": "pct_util",
					"operator": "gte",
					"value": 95
				}
			],
			"window": 3
		}
	]
}



### 机器Load5
# @ machine/machine_load5
POST {{url}}/api/orgs/alerts
Content-Type: application/json
Org-ID: {{org_id}}
User-ID: {{user_id}}

{
	"alertScope": "org",
	"alertScopeId": "1",
	"clusterName": "terminus-dev",
	"domain": "http://terminus.app.terminus.io",
	"enable": true,
	"name": "机器Load5",
	"notifies": [
		{
			"dingdingUrl": "{{dingding}}",
			"type": "dingding"
		}
	],
	"rules": [
		{
			"alertIndex": "machine_load5",
			"functions": [
				{
					"aggregator": "avg",
					"field": "load5",
					"operator": "gte",
					"value": null
				}
			],
			"window": 1
		}
	]
}



### 网盘
# @ machine/machine_netdisk
POST {{url}}/api/orgs/alerts
Content-Type: application/json
Org-ID: {{org_id}}
User-ID: {{user_id}}

{
	"alertScope": "org",
	"alertScopeId": "1",
	"clusterName": "terminus-dev",
	"domain": "http://terminus.app.terminus.io",
	"enable": true,
	"name": "网盘",
	"notifies": [
		{
			"dingdingUrl": "{{dingding}}",
			"type": "dingding"
		}
	],
	"rules": [
		{
			"alertIndex": "machine_netdisk",
			"functions": [
				{
					"aggregator": "value",
					"field": "used_percent",
					"operator": "gte",
					"value": 75
				}
			],
			"window": 1
		}
	]
}



### 机器宕机
# @ machine/machine_status
POST {{url}}/api/orgs/alerts
Content-Type: application/json
Org-ID: {{org_id}}
User-ID: {{user_id}}

{
	"alertScope": "org",
	"alertScopeId": "1",
	"clusterName": "terminus-dev",
	"domain": "http://terminus.app.terminus.io",
	"enable": true,
	"name": "机器宕机",
	"notifies": [
		{
			"dingdingUrl": "{{dingding}}",
			"type": "dingding"
		}
	],
	"rules": [
		{
			"alertIndex": "machine_status",
			"functions": [
				{
					"aggregator": "values",
					"field": "status",
					"operator": "all",
					"value": "not_ready"
				}
			],
			"window": 5
		}
	]
}

