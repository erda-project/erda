{
  "name": "kubernetes节点异常",
  "alert_scope": "org",
  "attributes": {
    "level": "WARNING",
    "recover": "false",
    "alert_group": "{{cluster_name}}-{{node_name}}",
    "tickets_metric_key": "{{node_name}}"
  },
  "template": {
    "metrics": ["kubernetes_node"],
    "window": 1,
    "filters": [
      {
        "tag": "cluster_name",
        "operator": "in",
        "value": ["$cluster_name"]
      },
      {
        "tag": "offline",
        "operator": "neq",
        "value": "true"
      }
    ],
    "group": [
      "cluster_name",
      "node_name"
    ],
    "functions": [
      {
        "aggregator": "values",
        "field": "ready",
        "operator": "all",
        "value": false
      },
      {
        "aggregator": "max",
        "alias": "allocatable_pods_value",
        "field": "allocatable_pods"
      },
      {
        "aggregator": "max",
        "alias": "capacity_pods_value",
        "field": "capacity_pods"
      },
      {
        "aggregator": "max",
        "alias": "allocatable_cpu_cores_value",
        "field": "allocatable_cpu_cores"
      },
      {
        "aggregator": "max",
        "alias": "capacity_cpu_cores_value",
        "field": "capacity_cpu_cores"
      },
      {
        "aggregator": "max",
        "alias": "allocatable_memory_bytes_value",
        "field": "allocatable_memory_bytes"
      },
      {
        "aggregator": "max",
        "alias": "capacity_memory_bytes_value",
        "field": "capacity_memory_bytes"
      }
    ],
    "select": {
      "cluster_name": "#cluster_name",
      "node_name": "#node_name",
      "component_name": "#node_name",
      "_meta": "#_meta",
      "_metric_scope": "#_metric_scope",
      "_metric_scope_id": "#_metric_scope_id",
      "org_name": "#org_name"
    },
    "outputs": [
      "alert"
    ]
  }
}
