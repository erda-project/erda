-- MIGRATION_BASE

-- maintainer: innerpeacez
-- added time: 2021/07/13

REPLACE INTO `sp_dashboard_block_system` (`id`,`name`,`desc`,`scope`,`scope_id`,`version`,`view_config`) VALUES ("topology_node_gateway","topology_node_gateway","","micro_service","global","v2",'[{"h":7,"i":"view-VrLq6JXO","view":{"api":{"body":{"from":["application_http_service"],"groupby":["req_host::tag"],"limit":3,"orderby":[{"dir":"DESC","expr":"sum(count_sum::field)"}],"select":[{"alias":"typeTybZBDTL","expr":"req_host::tag"},{"alias":"valuebD64VaGD","expr":"round_float(sum(count_sum::field), 2)"}],"where":["target_addon_type::tag=\'ApiGateway\'"]},"extraData":null,"header":null,"method":"post","query":{"end":"{{endTime}}","filter__metric_scope":"micro_service","filter__metric_scope_id":"{{terminusKey}}","format":"chartv2","ql":"influxql:ast","start":"{{startTime}}","type":"_"},"url":"/api/tmc/metrics-query"},"chartType":"table","config":{"dataSourceConfig":{"activedMetricGroups":["application_http"],"limit":3,"resultFilters":[{"alias":"Target Addon Type","field":"application_http-target_addon_type::tag","filter":{"operation":"=","value":"ApiGateway"},"key":"filterx3BvagjC","resultType":"string","type":"filter"}],"sortDimensions":[{"aggregation":"sum","alias":"请求次数","field":"application_http-elapsed_count::field","key":"sort9zKC6Rue","resultType":"number","sort":"DESC","type":"sort"}],"typeDimensions":[{"alias":"域名","field":"application_http-req_host::tag","key":"typeTybZBDTL","resultType":"string","type":"field"}],"valueDimensions":[{"aggregation":"sum","alias":"请求次数","field":"application_http-elapsed_count::field","key":"valuebD64VaGD","resultType":"number","type":"field"}]},"optionProps":{"isMoreThanOneDay":true,"moreThanOneDayFormat":"M/D"}},"controls":null,"dataSourceType":"api","description":"","staticData":{},"title":"域名请求 TOP 3"},"w":24,"x":0,"y":0},{"h":9,"i":"view-jipKAIYk","view":{"api":{"body":{"from":["application_http_service"],"groupby":["time()"],"select":[{"alias":"typeQXtBniA6","expr":"time()"},{"alias":"valueA2KagOZF","expr":"round_float(sum(count_sum::field), 2)"}],"where":["target_addon_type::tag=\'ApiGateway\'"]},"extraData":null,"header":null,"method":"post","query":{"end":"{{endTime}}","epoch":"ms","filter__metric_scope":"micro_service","filter__metric_scope_id":"{{terminusKey}}","format":"chartv2","ql":"influxql:ast","start":"{{startTime}}","type":"_"},"url":"/api/tmc/metrics-query"},"chartType":"chart:line","config":{"dataSourceConfig":{"activedMetricGroups":["application_http"],"resultFilters":[{"alias":"Target Addon Type","field":"application_http-target_addon_type::tag","filter":{"operation":"=","value":"ApiGateway"},"key":"filterb105rFvK","resultType":"string","type":"filter"}],"typeDimensions":[{"alias":"时间","key":"typeQXtBniA6","type":"time"}],"valueDimensions":[{"aggregation":"sum","alias":"请求次数","field":"application_http-elapsed_count::field","key":"valueA2KagOZF","resultType":"number","type":"field"}]},"optionProps":{"invalidToZero":true,"noAreaColor":true}},"controls":null,"dataSourceType":"api","description":"","staticData":{},"title":"吞吐量"},"w":24,"x":0,"y":8},{"h":9,"i":"view-R1FREHx6","view":{"api":{"body":{"from":["application_http"],"groupby":["time()"],"select":[{"alias":"type336bqk8x","expr":"time()"},{"alias":"valueywTyWVde","expr":"round_float(avg(elapsed_mean::field), 2)"}],"where":["target_addon_type::tag=\'ApiGateway\'"]},"extraData":null,"header":null,"method":"post","query":{"end":"{{endTime}}","epoch":"ms","filter__metric_scope":"micro_service","filter__metric_scope_id":"{{terminusKey}}","format":"chartv2","ql":"influxql:ast","start":"{{startTime}}","type":"_"},"url":"/api/tmc/metrics-query"},"chartType":"chart:line","config":{"dataSourceConfig":{"activedMetricGroups":["application_http"],"resultFilters":[{"alias":"Target Addon Type","field":"application_http-target_addon_type::tag","filter":{"operation":"=","value":"ApiGateway"},"key":"filterj1hRfnyW","resultType":"string","type":"filter"}],"typeDimensions":[{"alias":"时间","key":"type336bqk8x","type":"time"}],"valueDimensions":[{"aggregation":"avg","alias":"平均延迟（ms）","field":"application_http-elapsed_mean::field","key":"valueywTyWVde","resultType":"number","type":"field","unit":{"type":"TIME","unit":"ns"}}]},"optionProps":{"invalidToZero":true,"noAreaColor":true}},"controls":null,"dataSourceType":"api","description":"","staticData":{},"title":"响应时间"},"w":24,"x":0,"y":17}]');

SET NAMES utf8mb4;
BEGIN;
UPDATE `sp_metric_expression` SET `enable` = 0;
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"application_cache_service\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"elapsed\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_mean * field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_count; }\"}],\"group\":[\"component\",\"host\",\"source_terminus_key\",\"source_application_id\",\"source_runtime_name\",\"source_service_name\",\"source_addon_id\"],\"metric\":\"application_cache\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"component\":\"#component\",\"host\":\"#host\",\"source_addon_id\":\"#source_addon_id\",\"source_addon_type\":\"#source_addon_type\",\"source_application_id\":\"#source_application_id\",\"source_application_name\":\"#source_application_name\",\"source_project_id\":\"#source_project_id\",\"source_project_name\":\"#source_project_name\",\"source_runtime_id\":\"#source_runtime_id\",\"source_runtime_name\":\"#source_runtime_name\",\"source_service_id\":\"#source_service_id\",\"source_service_name\":\"#source_service_name\",\"source_terminus_key\":\"#source_terminus_key\",\"source_workspace\":\"#source_workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"application_db_service\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"elapsed\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_mean * field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_count; }\"}],\"group\":[\"component\",\"host\",\"source_terminus_key\",\"source_application_id\",\"source_runtime_name\",\"source_service_name\",\"source_addon_id\"],\"metric\":\"application_db\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"component\":\"#component\",\"host\":\"#host\",\"source_addon_id\":\"#source_addon_id\",\"source_addon_type\":\"#source_addon_type\",\"source_application_id\":\"#source_application_id\",\"source_application_name\":\"#source_application_name\",\"source_project_id\":\"#source_project_id\",\"source_project_name\":\"#source_project_name\",\"source_runtime_id\":\"#source_runtime_id\",\"source_runtime_name\":\"#source_runtime_name\",\"source_service_id\":\"#source_service_id\",\"source_service_name\":\"#source_service_name\",\"source_terminus_key\":\"#source_terminus_key\",\"source_workspace\":\"#source_workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"application_http_service\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"elapsed\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_mean * field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"errors\",\"field_script\":\"function invoke(field, tag){ return tag.error=='true'?field.elapsed_count:0; }\"}],\"group\":[\"host\",\"req_host\",\"target_terminus_key\",\"target_application_id\",\"target_runtime_name\",\"target_service_name\",\"target_addon_id\",\"source_terminus_key\",\"source_application_id\",\"source_runtime_name\",\"source_service_name\",\"source_addon_id\"],\"metric\":\"application_http\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"component\":\"#component\",\"host\":\"#host\",\"req_host\":\"#req_host\",\"source_addon_id\":\"#source_addon_id\",\"source_addon_type\":\"#source_addon_type\",\"source_application_id\":\"#source_application_id\",\"source_application_name\":\"#source_application_name\",\"source_project_id\":\"#source_project_id\",\"source_project_name\":\"#source_project_name\",\"source_runtime_id\":\"#source_runtime_id\",\"source_runtime_name\":\"#source_runtime_name\",\"source_service_id\":\"#source_service_id\",\"source_service_name\":\"#source_service_name\",\"source_terminus_key\":\"#source_terminus_key\",\"source_workspace\":\"#source_workspace\",\"target_addon_id\":\"#target_addon_id\",\"target_addon_type\":\"#target_addon_type\",\"target_application_id\":\"#target_application_id\",\"target_application_name\":\"#target_application_name\",\"target_instance_id\":\"#target_instance_id\",\"target_project_id\":\"#target_project_id\",\"target_project_name\":\"#target_project_name\",\"target_runtime_name\":\"#target_runtime_name\",\"target_service_id\":\"#target_service_id\",\"target_service_name\":\"#target_service_name\",\"target_terminus_key\":\"#target_terminus_key\",\"target_workspace\":\"#target_workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"application_mq_service\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"elapsed\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_mean * field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_count; }\"}],\"group\":[\"component\",\"host\",\"target_terminus_key\",\"target_application_id\",\"target_runtime_name\",\"target_service_name\",\"target_addon_id\",\"source_terminus_key\",\"source_application_id\",\"source_runtime_name\",\"source_service_name\",\"source_addon_id\"],\"metric\":\"application_mq\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"component\":\"#component\",\"host\":\"#host\",\"source_addon_id\":\"#source_addon_id\",\"source_addon_type\":\"#source_addon_type\",\"source_application_id\":\"#source_application_id\",\"source_application_name\":\"#source_application_name\",\"source_project_id\":\"#source_project_id\",\"source_project_name\":\"#source_project_name\",\"source_runtime_id\":\"#source_runtime_id\",\"source_runtime_name\":\"#source_runtime_name\",\"source_service_id\":\"#source_service_id\",\"source_service_name\":\"#source_service_name\",\"source_terminus_key\":\"#source_terminus_key\",\"source_workspace\":\"#source_workspace\",\"target_addon_id\":\"#target_addon_id\",\"target_addon_type\":\"#target_addon_type\",\"target_application_id\":\"#target_application_id\",\"target_application_name\":\"#target_application_name\",\"target_instance_id\":\"#target_instance_id\",\"target_project_id\":\"#target_project_id\",\"target_project_name\":\"#target_project_name\",\"target_runtime_name\":\"#target_runtime_name\",\"target_service_id\":\"#target_service_id\",\"target_service_name\":\"#target_service_name\",\"target_terminus_key\":\"#target_terminus_key\",\"target_workspace\":\"#target_workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"application_rpc_service\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"elapsed\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_mean * field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return field.elapsed_count; }\"},{\"aggregator\":\"sum\",\"field\":\"errors\",\"field_script\":\"function invoke(field, tag){ return tag.error=='true'?field.elapsed_count:0; }\"}],\"group\":[\"component\",\"host\",\"target_terminus_key\",\"target_application_id\",\"target_runtime_name\",\"target_service_name\",\"target_addon_id\",\"source_terminus_key\",\"source_application_id\",\"source_runtime_name\",\"source_service_name\",\"source_addon_id\"],\"metric\":\"application_rpc\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"component\":\"#component\",\"host\":\"#host\",\"source_addon_id\":\"#source_addon_id\",\"source_addon_type\":\"#source_addon_type\",\"source_application_id\":\"#source_application_id\",\"source_application_name\":\"#source_application_name\",\"source_project_id\":\"#source_project_id\",\"source_project_name\":\"#source_project_name\",\"source_runtime_id\":\"#source_runtime_id\",\"source_runtime_name\":\"#source_runtime_name\",\"source_service_id\":\"#source_service_id\",\"source_service_name\":\"#source_service_name\",\"source_terminus_key\":\"#source_terminus_key\",\"source_workspace\":\"#source_workspace\",\"target_addon_id\":\"#target_addon_id\",\"target_addon_type\":\"#target_addon_type\",\"target_application_id\":\"#target_application_id\",\"target_application_name\":\"#target_application_name\",\"target_instance_id\":\"#target_instance_id\",\"target_project_id\":\"#target_project_id\",\"target_project_name\":\"#target_project_name\",\"target_runtime_name\":\"#target_runtime_name\",\"target_service_id\":\"#target_service_id\",\"target_service_name\":\"#target_service_name\",\"target_terminus_key\":\"#target_terminus_key\",\"target_workspace\":\"#target_workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"leaf_component_status\",\"filters\":[{\"operator\":\"eq\",\"tag\":\"alert_type\",\"value\":\"dice_addon\"}],\"functions\":[{\"aggregator\":\"max\",\"alias\":\"health_status\",\"field\":\"__level\",\"field_script\":\"function invoke(field,tag){if(tag.level===\\\"FATAL\\\"){return 2}return 1}\"},{\"aggregator\":\"value\",\"alias\":\"weight\",\"field\":\"__weight\",\"field_script\":\"function invoke(field,tag){return 0}\"}],\"group\":[\"cluster_name\",\"addon_id\"],\"metric\":\"analyzer-alert\",\"outputs\":[\"metric\"],\"select\":{\"_meta\":\"#_meta\",\"_metric_scope\":\"#_metric_scope\",\"_metric_scope_id\":\"#_metric_scope_id\",\"cluster_name\":\"#cluster_name\",\"component_group\":\"dice_addon\",\"component_name\":\"#addon_id\",\"message\":\"#alert_name\",\"org_id\":\"#dice_org_id\",\"org_name\":\"#org_name\"},\"window\":8,\"windowBehavior\":\"allowedLateness\"}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"leaf_component_status\",\"filter\":{},\"functions\":[{\"aggregator\":\"max\",\"alias\":\"health_status\",\"field\":\"health_status\",\"field_script\":\"function invoke(field,tag){switch(field.status){case\\\"fail\\\":case\\\"unavailable\\\":return 2;case\\\"warning\\\":case\\\"unknown\\\":return 1;default:return 0}};\"},{\"aggregator\":\"value\",\"alias\":\"weight\",\"field\":\"weight\",\"field_script\":\"function invoke(field,tag){var a=new Array(\\\"pipeline\\\",\\\"scheduler\\\",\\\"openapi\\\",\\\"cmdb\\\",\\\"telegraf\\\",\\\"telegraf-platform\\\");if(a.indexOf(tag.dice_component)!=-1){return 1}else{return 0}};\"}],\"group\":[\"cluster_name\",\"dice_component\",\"dice_pod_name\"],\"metric\":\"dice_health\",\"outputs\":[\"metric\"],\"select\":{\"_meta\":\"#_meta\",\"_metric_scope\":\"#_metric_scope\",\"_metric_scope_id\":\"#_metric_scope_id\",\"cluster_name\":\"#cluster_name\",\"component_group\":\"dice_component\",\"component_name\":\"#dice_component\",\"message\":\"#message\",\"org_name\":\"#org_name\"},\"window\":8,\"windowBehavior\":\"allowedLateness\"}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"leaf_component_status\",\"filters\":[{\"operator\":\"eq\",\"tag\":\"alert_type\",\"value\":\"kubernetes\"}],\"functions\":[{\"aggregator\":\"max\",\"alias\":\"health_status\",\"field\":\"__level\",\"field_script\":\"function invoke(field,tag){if(tag.level===\\\"FATAL\\\"){return 2}return 1}\"},{\"aggregator\":\"value\",\"alias\":\"weight\",\"field\":\"__weight\",\"field_script\":\"function invoke(field,tag){if(!tag.component_name){return 0}var a=[\\\"calico\\\",\\\"coredns\\\",\\\"kube-apiserver\\\",\\\"kube-controller-manager\\\",\\\"kube-etcd\\\",\\\"kube-proxy\\\",\\\"kube-scheduler\\\",\\\"nginx-ingress-controller\\\"];for(var i=0;i\\u003ca.length;i++){if(tag.component_name.indexOf(a[i])!==-1){return 1}}return 0}\"}],\"group\":[\"cluster_name\",\"component_name\"],\"metric\":\"analyzer-alert\",\"outputs\":[\"metric\"],\"select\":{\"_meta\":\"#_meta\",\"_metric_scope\":\"#_metric_scope\",\"_metric_scope_id\":\"#_metric_scope_id\",\"cluster_name\":\"#cluster_name\",\"component_group\":\"kubernetes\",\"component_name\":\"#component_name\",\"message\":\"#alert_name\",\"org_id\":\"#dice_org_id\",\"org_name\":\"#org_name\"},\"window\":8,\"windowBehavior\":\"allowedLateness\"}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"leaf_component_status\",\"filters\":[{\"operator\":\"eq\",\"tag\":\"alert_type\",\"value\":\"machine\"}],\"functions\":[{\"aggregator\":\"max\",\"alias\":\"health_status\",\"field\":\"__level\",\"field_script\":\"function invoke(field,tag){if(tag.level===\\\"FATAL\\\"){return 2}return 1}\"},{\"aggregator\":\"value\",\"alias\":\"weight\",\"field\":\"__weight\",\"field_script\":\"function invoke(field,tag){if(!tag.labels){return 0}if(tag.labels.indexOf(\\\"lb\\\")!==-1||tag.labels.indexOf(\\\"master\\\")!==-1){return 1}return 0}\"}],\"group\":[\"cluster_name\",\"host_ip\"],\"metric\":\"analyzer-alert\",\"outputs\":[\"metric\"],\"select\":{\"_meta\":\"#_meta\",\"_metric_scope\":\"#_metric_scope\",\"_metric_scope_id\":\"#_metric_scope_id\",\"cluster_name\":\"#cluster_name\",\"component_group\":\"machine\",\"component_name\":\"#host_ip\",\"message\":\"#alert_name\",\"org_name\":\"#_metric_scope_id\"},\"window\":8,\"windowBehavior\":\"allowedLateness\"}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"leaf_component_status\",\"filters\":null,\"functions\":[{\"aggregator\":\"value\",\"alias\":\"health_status\",\"field\":\"__level\",\"field_script\":\"function invoke(field,tag){if(field.status===\\\"ready\\\"){return 0}return 2}\"},{\"aggregator\":\"value\",\"alias\":\"weight\",\"field\":\"__weight\",\"field_script\":\"function invoke(field,tag){if(!tag.labels){return 0}if(tag.labels.indexOf(\\\"lb\\\")!=-1||tag.labels.indexOf(\\\"master\\\")!=-1){return 1}return 0}\"}],\"group\":[\"cluster_name\",\"host_ip\"],\"metric\":\"host_status\",\"outputs\":[\"metric\"],\"select\":{\"_meta\":\"#_meta\",\"_metric_scope\":\"#_metric_scope\",\"_metric_scope_id\":\"#_metric_scope_id\",\"cluster_name\":\"#cluster_name\",\"component_group\":\"machine\",\"component_name\":\"#host_ip\",\"message\":\"\",\"org_id\":\"#_metric_scope_id\",\"org_name\":\"#_metric_scope_id\"},\"window\":8,\"windowBehavior\":\"allowedLateness\"}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"service_node\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return 1; }\"}],\"group\":[\"terminus_key\",\"application_id\",\"runtime_name\",\"service_name\"],\"metric\":\"jvm_memory\",\"outputs\":[\"metric\"],\"select\":{\"application_id\":\"#application_id\",\"application_name\":\"#application_name\",\"project_id\":\"#project_id\",\"project_name\":\"#project_name\",\"runtime_id\":\"#runtime_id\",\"runtime_name\":\"#runtime_name\",\"service_id\":\"#service_id\",\"service_instance_id\":\"#service_instance_id\",\"service_ip\":\"#service_ip\",\"service_mesh\":\"#service_mesh\",\"service_name\":\"#service_name\",\"terminus_key\":\"#terminus_key\",\"workspace\":\"#workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"ta_metric_mobile_metrics\",\"filters\":[{\"operator\":\"any\",\"tag\":\"registrationTime\"}],\"functions\":[{\"aggregator\":\"value\",\"field\":\"firstDayUserId\",\"field_script\":\"function invoke(field, tag) { if (new Date(parseInt(tag.registrationTime)).toDateString() === new Date().toDateString()) { return tag.uid } return null }\"},{\"aggregator\":\"value\",\"field\":\"secondDayUserId\",\"field_script\":\"function invoke(field, tag) {var end = new Date(new Date(new Date().toLocaleDateString()).getTime());var start = new Date(new Date(new Date(parseInt(tag.registrationTime)).toLocaleDateString()).getTime());var days = end.getTime() - start.getTime();var day1 = parseInt(days / (1000 * 60 * 60 * 24));if (day1 === 1) {return tag.uid}return null}\"}],\"group\":[\"uid\"],\"metric\":\"ta_metric_mobile_metrics\",\"outputs\":[\"metric\"],\"select\":{\"ai\":\"#ai\",\"av\":\"#av\",\"br\":\"#br\",\"ch\":\"#ch\",\"channel\":\"#channel\",\"cid\":\"#cid\",\"cpu\":\"#cpu\",\"device\":\"#device\",\"doc_path\":\"#doc_path\",\"gps\":\"#gps\",\"host\":\"#host\",\"ip\":\"#ip\",\"jb\":\"#jb\",\"mem\":\"#mem\",\"ns\":\"#ns\",\"os\":\"#os\",\"osv\":\"#osv\",\"rom\":\"#rom\",\"sd\":\"#sd\",\"sdk\":\"#sdk\",\"sr\":\"#sr\",\"tk\":\"#tk\",\"type\":\"#type\",\"uid\":\"#uid\",\"vid\":\"#vid\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"service_node\",\"filter\":{},\"functions\":[{\"aggregator\":\"sum\",\"field\":\"count\",\"field_script\":\"function invoke(field, tag){ return 1; }\"}],\"group\":[\"terminus_key\",\"application_id\",\"runtime_name\",\"service_name\"],\"metric\":\"nodejs_memory\",\"outputs\":[\"metric\"],\"select\":{\"application_id\":\"#application_id\",\"application_name\":\"#application_name\",\"project_id\":\"#project_id\",\"project_name\":\"#project_name\",\"runtime_id\":\"#runtime_id\",\"runtime_name\":\"#runtime_name\",\"service_id\":\"#service_id\",\"service_instance_id\":\"#service_instance_id\",\"service_ip\":\"#service_ip\",\"service_mesh\":\"#service_mesh\",\"service_name\":\"#service_name\",\"terminus_key\":\"#terminus_key\",\"workspace\":\"#workspace\"},\"window\":3}","3.0");
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"trace\",\"filter\":{},\"functions\":[{\"aggregator\":\"min\",\"alias\":\"start_time\",\"field\":\"start_time\"},{\"aggregator\":\"max\",\"alias\":\"end_time\",\"field\":\"end_time\"},{\"aggregator\":\"distinct\",\"alias\":\"components\",\"field\":\"components\",\"field_script\":\"function invoke(field, tag){ if(tag.span_layer=='http' || tag.span_layer=='rpc') return tag.service_name; return tag.component; }\"},{\"aggregator\":\"sum\",\"field\":\"errors\",\"field_script\":\"function invoke(field, tag){ return tag.error=='true'?1:0; }\"},{\"aggregator\":\"distinct\",\"alias\":\"application_names\",\"field\":\"applications\",\"field_script\":\"function invoke(field, tag){ return tag.application_name; }\"},{\"aggregator\":\"distinct\",\"alias\":\"applications_ids\",\"field\":\"applications_ids\",\"field_script\":\"function invoke(field, tag){ return tag.application_id; }\"},{\"aggregator\":\"distinct\",\"alias\":\"service_names\",\"field\":\"service_names\",\"field_script\":\"function invoke(field, tag){ return tag.service_name; }\"},{\"aggregator\":\"distinct\",\"alias\":\"service_ids\",\"field\":\"service_ids\",\"field_script\":\"function invoke(field, tag){ return tag.service_id; }\"},{\"aggregator\":\"distinct\",\"alias\":\"dubbo_methods\",\"field\":\"dubbo_methods\",\"field_script\":\"function invoke(field, tag){ return tag.dubbo_method; }\"},{\"aggregator\":\"distinct\",\"alias\":\"http_paths\",\"field\":\"http_paths\",\"field_script\":\"function invoke(field, tag){ return tag.http_path; }\"},{\"aggregator\":\"distinct\",\"alias\":\"terminus_keys\",\"field\":\"terminus_keys\",\"field_script\":\"function invoke(field, tag){ return tag.terminus_key; }\"}],\"group\":[\"trace_id\"],\"metric\":\"span\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"org_id\":\"#org_id\",\"org_name\":\"#org_name\",\"project_id\":\"#project_id\",\"project_name\":\"#project_name\",\"trace_id\":\"#trace_id\",\"workspace\":\"#workspace\"},\"window\":3}","3.0");
COMMIT;

