UPDATE `sp_metric_expression` SET `enable` = 0 WHERE `id` = (SELECT `id` FROM (SELECT `id` FROM `sp_metric_expression` WHERE `enable` = 1 AND `expression` LIKE "%\"alias\":\"trace\"%") AS `ids`);
INSERT `sp_metric_expression`(`attributes`,`expression`,`version`) VALUES("{}","{\"alias\":\"trace\",\"filter\":{},\"functions\":[{\"aggregator\":\"min\",\"alias\":\"start_time\",\"field\":\"start_time\"},{\"aggregator\":\"max\",\"alias\":\"end_time\",\"field\":\"end_time\"},{\"aggregator\":\"distinct\",\"alias\":\"components\",\"field\":\"components\",\"field_script\":\"function invoke(field, tag){ if(tag.span_layer=='http' || tag.span_layer=='rpc') return tag.service_name; return tag.component; }\"},{\"aggregator\":\"sum\",\"field\":\"errors\",\"field_script\":\"function invoke(field, tag){ return tag.error=='true'?1:0; }\"},{\"aggregator\":\"distinct\",\"alias\":\"application_names\",\"field\":\"applications\",\"field_script\":\"function invoke(field, tag){ return tag.application_name; }\"},{\"aggregator\":\"distinct\",\"alias\":\"applications_ids\",\"field\":\"applications_ids\",\"field_script\":\"function invoke(field, tag){ return tag.application_id; }\"},{\"aggregator\":\"distinct\",\"alias\":\"service_names\",\"field\":\"service_names\",\"field_script\":\"function invoke(field, tag){ return tag.service_name; }\"},{\"aggregator\":\"distinct\",\"alias\":\"service_ids\",\"field\":\"service_ids\",\"field_script\":\"function invoke(field, tag){ return tag.service_id; }\"},{\"aggregator\":\"distinct\",\"alias\":\"rpc_methods\",\"field\":\"rpc_methods\",\"field_script\":\"function invoke(field, tag){ return tag.rpc_method; }\"},{\"aggregator\":\"distinct\",\"alias\":\"rpc_targets\",\"field\":\"rpc_targets\",\"field_script\":\"function invoke(field, tag){ return tag.rpc_target; }\"},{\"aggregator\":\"distinct\",\"alias\":\"http_paths\",\"field\":\"http_paths\",\"field_script\":\"function invoke(field, tag){ return tag.http_path; }\"},{\"aggregator\":\"distinct\",\"alias\":\"db_names\",\"field\":\"db_names\",\"field_script\":\"function invoke(field, tag){ return tag.db_name; }\"},{\"aggregator\":\"distinct\",\"alias\":\"db_systems\",\"field\":\"db_systems\",\"field_script\":\"function invoke(field, tag){ return tag.db_system; }\"},{\"aggregator\":\"distinct\",\"alias\":\"topics\",\"field\":\"topics\",\"field_script\":\"function invoke(field, tag){ return tag.message_bus_destination; }\"},{\"aggregator\":\"distinct\",\"alias\":\"env_ids\",\"field\":\"env_ids\",\"field_script\":\"function invoke(field, tag){ return tag.env_id; }\"},{\"aggregator\":\"distinct\",\"alias\":\"terminus_keys\",\"field\":\"terminus_keys\",\"field_script\":\"function invoke(field, tag){ return tag.terminus_key; }\"},{\"aggregator\":\"value\",\"alias\":\"trace_duration\",\"field\":\"trace_duration\",\"field_script\":\"function invoke(field, tag){ return field.end_time - field.start_time; }\",\"trigger\":\"aggregated\"},{\"aggregator\":\"sum\",\"alias\":\"span_count\",\"field\":\"span_count\",\"field_script\":\"function invoke(field, tag){ return 1; }\"},{\"aggregator\":\"distinct\",\"alias\":\"operation_names\",\"field\":\"operation_names\",\"field_script\":\"function invoke(field, tag){ if( tag.parent_id || tag.parent_id!='' ) return null; else return tag.operation_name; }\"}],\"group\":[\"trace_id\"],\"metric\":\"span\",\"outputs\":[\"metric\"],\"select\":{\"cluster_name\":\"#cluster_name\",\"org_id\":\"#org_id\",\"org_name\":\"#org_name\",\"project_id\":\"#project_id\",\"project_name\":\"#project_name\",\"trace_id\":\"#trace_id\",\"workspace\":\"#workspace\"},\"window\":1}","3.0");