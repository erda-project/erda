syntax = "proto3";

package erda.dop.guide;
option go_package = "github.com/erda-project/erda-proto-go/dop/guide/pb";
import "github.com/mwitkow/go-proto-validators/validator.proto";
import "google/api/annotations.proto";
import "common/openapi.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

service GuideService {
  option(erda.common.openapi_service) = {
    service : "dop",
    auth : {
      check_login : true,
      check_token : true,
    }
  };

  rpc ListGuide(ListGuideRequest)
      returns(ListGuideResponse) {
    option(google.api.http) = {
      get : "/api/guide",
    };
    option(erda.common.openapi) = {
      path : "/api/guide",
    };
  }

  rpc JudgeCanCreatePipeline(JudgeCanCreatePipelineRequest)
      returns(JudgeCanCreatePipelineResponse) {
    option(google.api.http) = {
      get : "/api/guide/{ID}/actions/judge",
    };
    option(erda.common.openapi) = {
      path : "/api/guide/{ID}/actions/judge",
    };
  }
}

message ListGuideRequest {
  string kind = 1;
  uint64 projectID = 2;
}

message ListGuideResponse {
  repeated Guide data = 1;
}

message Guide {
  string ID = 1 [json_name = "id"];
  string jumpLink = 2;
  string status = 3;
  string creator = 4;
  string kind = 5;
  uint64 OrgID = 6;
  uint64 projectID = 7;
  uint64 appID = 8;
  google.protobuf.Timestamp timeCreated = 9;
  google.protobuf.Timestamp timeUpdated = 10;
}

message JudgeCanCreatePipelineRequest {
  string ID = 1 [json_name = "id"];
}

message JudgeCanCreatePipelineResponse {
  bool CanCreate = 1;
  uint64 AppID = 2;
  string Branch = 3;
  string Path = 4;
  string FileName = 5;
}